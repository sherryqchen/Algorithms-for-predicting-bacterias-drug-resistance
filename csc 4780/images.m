%% ?????
% ?????????????????????????????????
clc
clear;close all;  
%
%?????  
I = imread('PIL-1_3dayLBCR-1.jpg');  
% figure;imshow(I);  
%  
%?????? 
h = I;
if ndims(h) == 3
    h = rgb2gray(I);  
end
% figure;imshow(h);%????  
% h = imcomplement(h);%??  
% figure;imshow(h);  
%  
%????????  
h = medfilt2(h,[4,4]);  
bw = imbinarize(h,graythresh(h));  
%  
%????  
se = strel('disk',2);  
bw = imclose(bw,se);  
% figure;imshow(bw);  
%  
%?????????????  
bw  = imfill(bw,'holes');  
%  
%????  
[B,L] = bwboundaries(bw,'noholes');  
% ?????????????  
figure;
imshow(label2rgb(L, @jet, [1 1 1]))  
hold on  
for k = 1:length(B)  
  boundary = B{k};  
  plot(boundary(:,2), boundary(:,1), 'b', 'LineWidth', 2)  
end  
%  
%????  
roundness = zeros(size(B,1), 3); %??????????????????????????????????
stats = regionprops(L,'Area','Centroid');
threshold = 0.94;% ?????????length(B)????????,???????????  
for k = 1:length(B)  % ??????'  
    boundary = B{k};  % ????  
    delta_sq = diff(boundary).^2;  
    perimeter = sum(sqrt(sum(delta_sq,2)));  % ????K???????  
    area = stats(k).Area;  % ??????4*PI*A/P^2  
    metric = 4*pi*area/perimeter^2;  % ????  
    roundness(k,:) = [perimeter, area, metric ];
    metric_string = sprintf('%2.2f',metric);  % ??????????????threshold = 0.94 ???
    if metric > threshold  
        centroid = stats(k).Centroid;  
%         plot(640-centroid(2), 640-centroid(1),'wo');  
        plot(centroid(1), centroid(2),'ko');  
        text(centroid(1), centroid(2),metric_string,'Color','r',...  
                            'FontSize',14,'FontWeight','bold');
    end  
end
title('????????????1?');
%% ???????????????????
% method 1
a = struct2cell( stats );
b = a(1,:);
c = cell2mat( b );
figure,plot(c)
% method 2
% d = struct2array( stats );
% e = d(1:3:end);
% figure,plot(e)
